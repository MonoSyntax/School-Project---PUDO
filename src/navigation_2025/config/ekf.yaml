ekf_filter_node:
    ros__parameters:
        frequency: 30.0
        two_d_mode: true
        publish_acceleration: false
        predict_to_current_time: false
        publish_tf: true
        odom_frame: odom
        base_link_frame: base_footprint
        world_frame: odom
        transform_timeout: 0.1

        odom0: /odom
        odom0_config: [true, true, true,
                    false, false, false,
                    true,  true,  true,
                    false, false, false,
                    false, false, false]
        odom0_queue_size: 5
        odom0_nodelay: true
        odom0_differential: false
        odom0_relative: false
        odom0_rejection_threshold: 2.0

        odom1: odometry/gps
        odom1_config: [false, false, false,
                    false, false, false,
                    false, false, false,
                    false, false, false,
                    false, false, false]
        odom1_queue_size: 10
        odom1_nodelay: true
        odom1_differential: false
        odom1_relative: false
        odom1_rejection_threshold: 10.0

        imu0: /imu
        imu0_config: [false, false, false,
                    true,  true,  true,
                    false, false, false,
                    true,  true,  true,
                    true,  true,  true]
        imu0_remove_gravitational_acceleration: true
        imu0_queue_size: 5
        imu0_nodelay: true
        imu0_differential: false
        imu0_relative: false
        imu0_rejection_threshold: 1.0

        # ACKERMANN-SPECIFIC PROCESS NOISE COVARIANCE
        # 
        # Key differences from differential drive:
        # 1. LOWER lateral (y) noise - Ackermann vehicles have less lateral slip
        # 2. HIGHER yaw noise - Wider turning radius means more uncertainty in heading
        # 3. HIGHER yaw rate noise - Turning dynamics are slower and less predictable
        # 4. Forward (x) motion is more predictable due to non-holonomic constraints
        #
        # Matrix structure: [x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az]
        #
        process_noise_covariance: [
            0.005, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.003, 0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  # Reduced y noise
            0.0,  0.0,  0.006, 0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.003, 0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.003, 0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.008, 0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  # Increased yaw noise
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0025, 0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0015, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  # Reduced vy noise
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.004, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.001, 0.0,  0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.001, 0.0,  0.0,  0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.003, 0.0,  0.0,  0.0,  # Increased vyaw noise
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.001, 0.0,  0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.001, 0.0,
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,   0.0,   0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0015
        ]

navsat_transform:
    ros__parameters:
        frequency: 100.0
        delay: 3.0
        magnetic_declination_radians: 0.0
        yaw_offset: 1.4225
        zero_altitude: true
        broadcast_utm_transform: false
        publish_filtered_gps: true
        use_odometry_yaw: true
        wait_for_datum: false

imu_filter:
    ros__parameters:
        stateless: false
        use_mag: true
        publish_tf: false
        reverse_tf: false
        fixed_frame: "base_footprint"
        constant_dt: 0.0
        publish_debug_topics: false
        world_frame: "enu"
        gain: 0.05  # Reduced for more stable filtering
        zeta: 0.1   # Added damping for Ackermann motion
        mag_bias_x: 0.0
        mag_bias_y: 0.0
        mag_bias_z: 0.0
        orientation_stddev: 0.01
        remove_gravity_vector: true